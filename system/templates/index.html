<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能设备控制面板</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="header">
    <div class="time" id="time-display">--:--:--</div>
    <div class="status-icons">
      <i class="fas fa-wifi"></i>
      <i class="fas fa-bluetooth"></i>
      <i class="fas fa-signal"></i>
      <i class="fas fa-car"></i>
    </div>
  </div>

    <div class="main">
        <div class="left-panel">
            <div class="warning-lights">
                <i class="fas fa-triangle-exclamation warning-light flashing"></i>
                <i class="fas fa-car-battery warning-light"></i>
                <i class="fas fa-thermometer-half warning-light"></i>
                <i class="fa fa-bell"></i>
            </div>
          <div id="gauge"></div>
          <div class="panel">
            <p>> 系统启动 . . .</p>
            <p>> hello，我是小e</p>
            <div id="live-output" style="margin-top: 20px;">
              <h2>实时识别输出</h2>
              <div id="output-box" style="background:#001f33; padding:10px; border-radius:8px; max-height:200px; overflow-y:auto; color:#ffffff; font-family:monospace;font-size: 16px;"></div>
            </div>
          </div>
        </div>

        <div class="right-panel">
            <div class="card-container">
                <button class="arrow prev-arrow" onclick="prevSlide()">&#10094;</button>
                <div class="card-slider" id="card-slider">
                    <div class="card">
                        <i class="fas fa-home"></i>
                        <h2>首页 <span class="status-indicator"></span></h2>
                        <p>显示设备概览和常用快捷操作，返回主控制界面</p>
                        <button class="btn" onclick="showNotification('已返回主界面')">返回首页</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-location-arrow"></i>
                        <h2>导航</h2>
                        <p>提供位置服务和路线规划，支持室内外导航</p>
                        <button class="btn" onclick="showNotification('导航功能已启动')">开始导航</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-music"></i>
                        <h2>媒体 <span class="status-indicator status-off"></span></h2>
                        <p>多媒体播放控制，支持音乐、视频和图片浏览</p>
                        <div class="slider-container">
                          <input type="range" min="0" max="100" value="70" class="slider" id="volume-slider">
                        </div>
                        <button class="btn" onclick="toggleMedia()">播放/暂停</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-satellite-dish"></i>
                        <h2>通信</h2>
                        <p>管理电话、消息和视频通话等通信功能</p>
                        <button class="btn" onclick="showNotification('正在连接通信服务...')">连接设备</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-cogs"></i>
                        <h2>系统设置</h2>
                        <p>调整设备参数、网络设置和个性化选项</p>
                        <button class="btn" onclick="showNotification('打开系统设置面板')">打开设置</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-camera"></i>
                        <h2>摄像头</h2>
                        <p>控制摄像头设备，拍照、录像和监控</p>
                        <button class="btn" onclick="toggleCamera()">开启/关闭</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-robot"></i>
                        <h2>AI助手</h2>
                        <p>DeepSeek-R1智能助手，提供帮助和智能服务</p>
                        <button class="btn" onclick="showNotification('你好！我是DeepSeek-R1，很高兴为您服务')">对话</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-music"></i>
                        <h2>音乐</h2>
                        <p>音乐播放器，支持在线流媒体和本地播放</p>
                        <div class="slider-container">
                          <input type="range" min="0" max="100" value="40" class="slider" id="music-slider">
                        </div>
                        <button class="btn" onclick="toggleMusic()">播放音乐</button>
                    </div>
                    <div class="card">
                        <i class="fas fa-snowflake"></i>
                        <h2>空调控制 <span class="status-indicator"></span></h2>
                        <p>调节温度、风速和运行模式</p>
                        <div class="slider-container">
                          <input type="range" min="16" max="30" value="24" class="slider" id="temp-slider">
                        </div>
                        <button class="btn" onclick="toggleAC()">开关空调</button>
                    </div>
                </div>
                <button class="arrow next-arrow" onclick="nextSlide()">&#10095;</button>
            </div>
        </div>
    </div>

    <div class="footer">
            <div class="menu-item" onclick="showNotification('返回主界面')">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </div>
            <div class="menu-item" onclick="showNotification('启动导航服务')">
                <i class="fas fa-location-arrow"></i>
                <span>导航</span>
            </div>
            <div class="menu-item" onclick="toggleMedia()">
                <i class="fas fa-music"></i>
                <span>媒体</span>
            </div>
            <div class="menu-item" onclick="showNotification('打开通信面板')">
                <i class="fas fa-satellite-dish"></i>
                <span>通信</span>
            </div>
            <div class="menu-item" onclick="showNotification('打开系统设置')">
                <i class="fas fa-cogs"></i>
                <span>设置</span>
            </div>
            <div class="menu-item" onclick="toggleCamera()">
                <i class="fas fa-camera"></i>
                <span>摄像头</span>
            </div>
            <div class="menu-item" onclick="showNotification('启动AI助手')">
                <i class="fas fa-robot"></i>
                <span>AI助手</span>
            </div>
            <div class="menu-item" onclick="toggleMusic()">
                <i class="fas fa-music"></i>
                <span>音乐</span>
            </div>
            <div class="menu-item" onclick="toggleAC()">
                <i class="fas fa-snowflake"></i>
                <span>空调</span>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        操作成功！
    </div>

    <script>
        let currentIndex = 0;
        const slides = document.querySelectorAll('.card');
        const totalSlides = slides.length;

        function showSlide(index) {
            const slider = document.getElementById('card-slider');
            slider.style.transform = `translateX(${-index * 50}%)`; // 每次移动50%
        }

        function nextSlide() {
            if (currentIndex < totalSlides - 2) { // 一次显示两张卡片
                currentIndex++;
                showSlide(currentIndex);
            }
        }

        function prevSlide() {
            if (currentIndex > 0) {
                currentIndex--;
                showSlide(currentIndex);
            }
        }

        // 初始化显示第一组卡片
        showSlide(currentIndex);

        // 通知功能
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 切换媒体播放状态
        function toggleMedia() {
            const indicator = document.querySelectorAll('.card:nth-child(3) .status-indicator')[0];
            indicator.classList.toggle('status-off');
            const status = indicator.classList.contains('status-off') ? '媒体已暂停' : '媒体播放中';
            showNotification(status);
        }
        
        // 切换音乐播放状态
        function toggleMusic() {
            const indicator = document.querySelectorAll('.card:nth-child(8) .status-indicator')[0];
            indicator.classList.toggle('status-off');
            const status = indicator.classList.contains('status-off') ? '音乐已暂停' : '音乐播放中';
            showNotification(status);
        }
        
        // 切换摄像头状态
        function toggleCamera() {
            const indicator = document.querySelectorAll('.card:nth-child(6) .status-indicator')[0];
            indicator.classList.toggle('status-off');
            const status = indicator.classList.contains('status-off') ? '摄像头已关闭' : '摄像头已开启';
            showNotification(status);
        }
        
        // 切换空调状态
        function toggleAC() {
            const indicator = document.querySelectorAll('.card:nth-child(9) .status-indicator')[0];
            indicator.classList.toggle('status-off');
            const status = indicator.classList.contains('status-off') ? '空调已关闭' : '空调已开启';
            showNotification(status);
        }
        
        // 初始化滑块事件
        document.addEventListener('DOMContentLoaded', function() {
            const volumeSlider = document.getElementById('volume-slider');
            const musicSlider = document.getElementById('music-slider');
            const tempSlider = document.getElementById('temp-slider');
            
            volumeSlider.addEventListener('input', function() {
                showNotification(`媒体音量调整至: ${this.value}%`);
            });
            
            musicSlider.addEventListener('input', function() {
                showNotification(`音乐音量调整至: ${this.value}%`);
            });
            
            tempSlider.addEventListener('input', function() {
                showNotification(`空调温度设置为: ${this.value}°C`);
            });
        });

    // 左上角时间
    function updateTime() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString();
      document.getElementById('time-display').textContent = timeStr;
    }
    setInterval(updateTime, 1000);
    updateTime();

  // 仪表盘
  var myChart = echarts.init(document.getElementById('gauge'));
        // 指定图表的配置项和数据
        var option = {
		    backgroundColor: 'transparent',
		    tooltip: {
		        formatter: '{a} <br/>{c} {b}'
		    },
		    toolbox: {
		        show: false,
		        feature: {
		            mark: {show: true},
		            restore: {show: true},
		            saveAsImage: {show: true}
		        }
		    },
		    series: [
		        {
		            name: '速度',
		            type: 'gauge',
		            min: 0,
		            max: 220,
		            splitNumber: 11,
		            radius: '85%',
		            axisLine: {            // 坐标轴线
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: [[0.09, 'lime'], [0.82, '#1e90ff'], [1, '#ff4500']],
		                    width: 3,
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            axisLabel: {            // 坐标轴小标记
		                fontWeight: 'bolder',
		                color: '#fff',
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 10
		            },
		            axisTick: {            // 坐标轴小标记
		                length: 15,        // 属性length控制线长
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: 'auto',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            splitLine: {           // 分隔线
		                length: 25,         // 属性length控制线长
		                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
		                    width: 3,
		                    color: '#fff',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            pointer: {           // 分隔线
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 5
		            },
		            title: {
		                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
		                    fontWeight: 'bolder',
		                    fontSize: 14,
		                    fontStyle: 'italic',
		                    color: '#fff',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            detail: {
		                backgroundColor: 'rgba(30,144,255,0.8)',
		                borderWidth: 1,
		                borderColor: '#fff',
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 5,
		                offsetCenter: [0, '50%'],       // x, y，单位px
                    padding: [1, 1],
		                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
		                    fontWeight: 'bolder',
		                    color: '#fff',
                        fontSize: 14
		                }
		            },
		            data: [{value: 40, name: 'km/h'}]
		        },
		        {
		            name: '转速',
		            type: 'gauge',
		            center: ['19%', '53%'],    // 默认全局居中
		            radius: '60%',
		            min: 0,
		            max: 7,
		            endAngle: 45,
		            splitNumber: 7,
		            axisLine: {            // 坐标轴线
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: [[0.29, 'lime'], [0.86, '#1e90ff'], [1, '#ff4500']],
		                    width: 2,
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            axisLabel: {            // 坐标轴小标记
		                fontWeight: 'bolder',
		                color: '#fff',
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 10
		            },
		            axisTick: {            // 坐标轴小标记
		                length: 12,        // 属性length控制线长
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: 'auto',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            splitLine: {           // 分隔线
		                length: 20,         // 属性length控制线长
		                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
		                    width: 3,
		                    color: '#fff',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            pointer: {
		                width: 5,
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 5
		            },
		            title: {
		                offsetCenter: [0, '-30%'],       // x, y，单位px
		                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
		                    fontWeight: 'bolder',
		                    fontStyle: 'italic',
		                    color: '#fff',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            detail: {
		                //backgroundColor: 'rgba(30,144,255,0.8)',
		                // borderWidth: 1,
		                borderColor: '#fff',
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 5,
		                width: 80,
		                height: 30,
		                offsetCenter: [25, '20%'],       // x, y，单位px
		                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
		                    fontWeight: 'bolder',
		                    color: '#fff',
                        fontSize: 14
		                }
		            },
		            data: [{value: 1.0, name: 'x1000 r/min'}],
                name: {
                  fontSize: 5,
                  color: '#fff',
                }
		        },
		        {
		            name: '油表',
		            type: 'gauge',
		            center: ['80%', '50%'],    // 默认全局居中
		            radius: '55%',
		            min: 0,
		            max: 2,
		            startAngle: 135,
		            endAngle: 45,
		            splitNumber: 2,
		            axisLine: {            // 坐标轴线
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: [[0.2, 'lime'], [0.8, '#1e90ff'], [1, '#ff4500']],
		                    width: 2,
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            axisTick: {            // 坐标轴小标记
		                length: 12,        // 属性length控制线长
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: 'auto',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            axisLabel: {
		                fontWeight: 'bolder',
		                color: '#fff',
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 10,
		                formatter: function (v){
		                    switch (v + '') {
		                        case '0': return 'E';
		                        case '1': return 'Gas';
		                        case '2': return 'F';
		                    }
		                }
		            },
		            splitLine: {           // 分隔线
		                length:15,         // 属性length控制线长
		                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
		                    width:3,
		                    color: '#fff',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            pointer: {
		                width:2,
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 5
		            },
		            title: {
		                show: false
		            },
		            detail: {
		                show: false
		            },
		            data: [{value: 0.5, name: 'gas'}]
		        },
		        {
		            name: '水表',
		            type: 'gauge',
		            center: ['80%', '50%'],    // 默认全局居中
		            radius: '55%',
		            min: 0,
		            max: 2,
		            startAngle: 315,
		            endAngle: 225,
		            splitNumber: 2,
		            axisLine: {            // 坐标轴线
		                lineStyle: {       // 属性lineStyle控制线条样式
		                    color: [[0.2, 'lime'], [0.8, '#1e90ff'], [1, '#ff4500']],
		                    width: 2,
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            axisTick: {            // 坐标轴小标记
		                show: false
		            },
		            axisLabel: {
		                fontWeight: 'bolder',
		                color: '#fff',
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 10,
		                formatter: function(v){
		                    switch (v + '') {
		                        case '0': return 'H';
		                        case '1': return 'Water';
		                        case '2': return 'C';
		                    }
		                }
		            },
		            splitLine: {           // 分隔线
		                length: 15,         // 属性length控制线长
		                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
		                    width: 3,
		                    color: '#fff',
		                    shadowColor: '#fff', //默认透明
		                    shadowBlur: 10
		                }
		            },
		            pointer: {
		                width: 2,
		                shadowColor: '#fff', //默认透明
		                shadowBlur: 5
		            },
		            title: {
		                show: false
		            },
		            detail: {
		                show: false
		            },
		            data:[{value: 0.5, name: 'gas'}]
		        }
		    ]
		};
		
		setInterval(function (){
		    option.series[0].data[0].value = (Math.random()*100).toFixed(2) - 0;
		    option.series[1].data[0].value = (Math.random()*7).toFixed(2) - 0;
		    option.series[2].data[0].value = (Math.random()*2).toFixed(2) - 0;
		    option.series[3].data[0].value = (Math.random()*2).toFixed(2) - 0;
		    myChart.setOption(option);
		},2000);

    // 输出内容添加
    const outputContent = document.getElementById("output-box");
    const eventSource = new EventSource("/stream");
    eventSource.onmessage = function(event) {
      console.log("接收到系统日志：", event.data);
      try {
        // const data = JSON.parse(event.data);
        const timestamp = new Date().toLocaleTimeString();
        const p = document.createElement('p');
        // p.textContent = `[${timestamp}]\n${JSON.stringify(data, null, 2)}\n\n`; 
        p.textContent = `[${timestamp}] ${event.data}`;
        outputContent.prepend(p)
      } catch (e) {
        console.error("解析数据失败:", e);
      }
    };
    eventSource.onerror = function(err) {
      console.error("SSE 错误：", err);
      outputContent.innerText = "连接已断开，请检查后端状态或刷新页面。";
    };
    </script>
</body>
</html>